План восстановления инфраструктуры.
Недоступность основного сервера базы данных.
В случаи ошибок базы данных требуется переключение db-primary (192.168.10.14) на PG-SECONDARY(192.168.10.3) на серверах приложения AppServer1(192.168.10.13) и AppServer2(192.168.10.6).
Для переключения базы данных требуется выполнить изменение конфиг файла LocalSetting.php
Перейдите в директорию приложения командой: cd cd /var/www/html/mediawiki/
Откройте файл LocalSettings.php для редактирования командой: sudo nano LocalSettings.php
Найдите строчки отвечающие за параметры подключения к базе данных:
•	$wgDBtype = "postgres";
•	$wgDBserver = "192.168.10.14"; // Поменяйте Ip адрес\Hostname на адрес базы данных pg-secondary (192.168.10.3)
•	$wgDBname = "######";
•	$wgDBuser = "#####";
•	$wgDBpassword = "#####";

1.	Подключитесь к Secondary серверу баз дынных pg-secondary (192.168.10.3)
2.	Выполните вход под пользователем postgres: su postgres
3.	Войдите в psql и выполните: psql 
4.	Необходимо указать secondary, что он теперь станет ведущим и может выполнять запись, выполнить promote.select pg_promote();
Ошибки базы данных.
При возникновении ошибок базы данных и\или ее утери на серверах баз данных требуется восстановить базу данных из бэкапа. Бэкап выполняется скриптом, который находится на DB-PRIMARY. 
Имя скрипта: backup_mediawiki.sh
Задание в crontab: 0  0    * * *    postgres /backup/backup_mediawiki.sh
 
Проверка бэкапа баз данных: в директории /backup/ выполните команду ls -la и выберите нужный бэкап:
 
Запустите psql от имени пользователя Postgres и удалите некорректную базу данных:
Команды на удаление: 
•	psql
•	drop database mediawiki;
 
Откройте скрипт в директории /backup/db-restore.sh , укажите имя необходимого бэкапа в переменной TIMESTAMP=”name”
 
Запустите скрипт /backup/db-restore.sh

Повреждение и\или удаление каталога приложения Mediawiki.
На сервере appserver1 (192.168.10.13) и appserver2 (192.168.10.6) файлы приложения находятся в каталоге /var/www/html/mediawiki. Каталог находится под заданием резервного копирования с сервера bkp-server (192.168.10.30). 
Для восстановления каталога приложения необходимо подключиться к серверу bkp-server (192.168.10.30). 
Перейдите в каталог с файлами бэкапа cd /mnt/backup/
Там находятся директории резервных файлов серверов appserver1, appserver2 и резервные копии базы данных приложения db.
Для восстановления бэкапа перейдите в каталог скриптов:
Cd /usr/local/bin/
Выберите необходимый скрипт:
•	appserver1-fetch.sh // скрипт бэкапа директории mediawiki с сервера appserver1
•	appserver1-restore.sh // скрипт восстановления директории mediawiki с сервера appserver1
•	appserver2-fetch.sh // скрипт бэкапа директории mediawiki с сервера appserver2
•	appserver2-restore.sh // скрипт восстановления директории mediawiki с сервера appserver1
•	backup-fetch.sh // скрипт копирования файла резервной копии базы данных с сервера db-primary
Выполните запуск необходимого скрипта и проверьте директорию на сервере.
